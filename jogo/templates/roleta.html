<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roleta da Sorte</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
    <div class="roleta-container">
        <header>
            <h2>Roleta da Sorte</h2>
            <a href="{{ url_for('escolher_jogo') }}">Voltar ao Lobby</a>
        </header>
        
        <div class="jogo-area">
            <div class="roleta-visual">
                <img src="{{ url_for('static', filename='roleta.png') }}" alt="Roleta">
                <div id="resultado-display" class="resultado-display">
                    <p>Faça sua aposta!</p>
                </div>
            </div>

            <div class="aposta-area">
                <h3>Faça sua Aposta</h3>
                <form id="aposta-form">
                    <div class="form-group">
                        <label>Valor da Aposta:</label>
                        <input type="number" id="valor-aposta" min="1" step="1" value="10" required>
                    </div>

                    <div class="form-group">
                        <label>Tipo de Aposta:</label>
                        <select id="tipo-aposta">
                            <option value="cor">Cor (Vermelho/Preto)</option>
                            <option value="numero">Número Específico</option>
                            <option value="par_impar">Par/Ímpar</option>
                        </select>
                    </div>

                    <div id="escolha-cor" class="escolha-group">
                        <label><input type="radio" name="escolha" value="vermelho" checked> Vermelho</label>
                        <label><input type="radio" name="escolha" value="preto"> Preto</label>
                    </div>

                    <div id="escolha-numero" class="escolha-group" style="display: none;">
                        <input type="number" id="numero-apostado" min="0" max="36" value="7">
                    </div>

                    <div id="escolha-par_impar" class="escolha-group" style="display: none;">
                        <label><input type="radio" name="escolha" value="par" checked> Par</label>
                        <label><input type="radio" name="escolha" value="impar"> Ímpar</label>
                    </div>

                    <button type="submit" id="btn-girar">Girar</button>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const socket = io();
            const form = document.getElementById('aposta-form');
            const tipoApostaSelect = document.getElementById('tipo-aposta');
            const btnGirar = document.getElementById('btn-girar');
            const resultadoDisplay = document.getElementById('resultado-display');

            function atualizarCamposAposta() {
                document.querySelectorAll('.escolha-group').forEach(div => div.style.display = 'none');
                const tipo = tipoApostaSelect.value;
                document.getElementById('escolha-' + tipo).style.display = 'block';

                if (tipo === 'cor') {
                    document.querySelector('input[name="escolha"][value="vermelho"]').checked = true;
                } else if (tipo === 'par_impar') {
                    document.querySelector('input[name="escolha"][value="par"]').checked = true;
                }
            }
            
            tipoApostaSelect.addEventListener('change', atualizarCamposAposta);

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                btnGirar.disabled = true;
                resultadoDisplay.innerHTML = '<p>Girando...</p>';

                const valor = document.getElementById('valor-aposta').value;
                const tipo = tipoApostaSelect.value;
                let escolha;

                if (tipo === 'numero') {
                    escolha = document.getElementById('numero-apostado').value;
                } else {
                    escolha = document.querySelector(`#escolha-${tipo} input[name="escolha"]:checked`).value;
                }

                socket.emit('girar_roleta', { valor, tipo, escolha });
            });

            socket.on('resultado_roleta', (data) => {
                let mensagem = `Número Sorteado: <strong class="numero-${data.cor}">${data.numero} (${data.cor})</strong><br>`;
                
                if (data.ganhou) {
                    mensagem += `<span class="ganhou">Você ganhou R$ ${data.valor_ganho.toFixed(2)}!</span>`;
                } else {
                    mensagem += `<span class="perdeu">Você perdeu.</span>`;
                }

                resultadoDisplay.innerHTML = mensagem;
                btnGirar.disabled = false;
            });

            atualizarCamposAposta();
        });
    </script>
</body>
</html>